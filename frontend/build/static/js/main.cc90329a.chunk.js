(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{464:function(e,t,n){e.exports=n(961)},469:function(e,t,n){},960:function(e,t,n){},961:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(166),o=n.n(r),m=(n(469),n(443)),i=n(444),u=n(459),s=n(445),l=n(460),d=n(56),h=n(58),b=n(23),f=n(11),p=n(57),g=n(446),v=n(242),O=n(447),j=n(114),I=n.n(j),E=(n(800),{apiKey:"AIzaSyCcrzECR6WLk_YtsCk6rUMbNxfFh0cn__8",authDomain:"tydev-ping-pong.firebaseapp.com",databaseURL:"https://tydev-ping-pong.firebaseio.com",projectId:"tydev-ping-pong",storageBucket:"tydev-ping-pong.appspot.com",messagingSenderId:"29869586839",appId:"1:29869586839:web:080ae459d72aa8f6"});I.a.initializeApp(E);var y=I.a.firestore(),_=n(5),T="INITIALIZE_GAME",w="INITIALIZE_MATCH",W="UPDATE_MATCH",S="UPDATE_GAME",k="EXIT_GAME",$="APP_ERROR",M="DECLARE_WINNER",N="UPDATE_IDS",G={totalGamesPlayed:0,winner:null};var C={};var x={error:!1,errorMessage:"",matchInit:!1};var A=Object(p.c)({match:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return t.payload.match;case W:return Object(_.a)({},e,{},t.payload);case k:return{};default:return e}},game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:case T:return Object(_.a)({},t.payload.game);case S:return t.payload||e;case k:return{};default:return e}},app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.error,c=t.payload;switch(n){case w:return Object(_.a)({},e,{matchId:c.matchId,gameId:c.gameId,matchInit:!0});case W:return Object(_.a)({},e,{matchInit:!0});case N:return Object(_.a)({},e,{},c);case $:return Object(_.a)({},e,{error:!0,errorMessage:a});case k:return Object(_.a)({},x,{matchInit:!1});default:return e}}}),F={},D=[g.a.withExtraArgument({getFirebase:O.getFirebase,getFirestore:v.getFirestore})],P=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||p.d,L=n(7),R=n(10),U=n(20),B=n(453);function q(){var e=Object(U.a)(["\n  mutation DeclareWinner(\n    $matchId: String!\n    $gameId: String!\n    $winner: TeamEnum!\n  ) {\n    declareWinner(matchId: $matchId, gameId: $gameId, winner: $winner) {\n      winner\n      gamesWon {\n        team1\n        team2\n      }\n    }\n  }\n"]);return q=function(){return e},e}function z(){var e=Object(U.a)(["\n  mutation UpdateScore(\n    $matchId: String!\n    $gameId: String!\n    $team: TeamEnum!\n    $score: Int!\n    $increment: Boolean!\n  ) {\n    updateScore(\n      matchId: $matchId\n      gameId: $gameId\n      team: $team\n      increment: $increment\n      score: $score\n    ) {\n      team1_score\n      team2_score\n      greenTeam\n    }\n  }\n"]);return z=function(){return e},e}var X=Object(f.b)(z()),H=Object(f.b)(q()),J=n(8);function K(){var e=Object(U.a)(["\n  query getActiveMatch {\n    activeMatch {\n      matchId\n      gameId\n      match {\n        gamesToWin\n        pointsToWin\n        team1_name\n        team2_name\n      }\n      game {\n        team1_score\n        team2_score\n        servingTeam\n      }\n    }\n  }\n"]);return K=function(){return e},e}var Z=Object(f.b)(K()),V=n(41),Y=n.n(V),Q=n(90),ee=function(e){var t=e.data,n=e.history;return function(){var e=Object(Q.a)(Y.a.mark(function e(a){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a({type:w,payload:t}),n.push("/match/".concat(t.matchId,"/game/").concat(t.gameId),Object(_.a)({},t));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},te=function(e){var t=e.data,n=e.history;return function(){var e=Object(Q.a)(Y.a.mark(function e(a){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a({type:T,payload:{game:Object(_.a)({},t.game)}}),n.push("/match/".concat(t.matchId,"/game/").concat(t.gameId),Object(_.a)({},t));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},ne=function(e){var t=e.buttonColor,n=e.dif,a=e.updateScore,c=e.nextGame,r=e.history;return function(){var e=Object(Q.a)(Y.a.mark(function e(o,m){var i,u,s,l,d,h;return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=m(),u=i.game,s=i.app,l=i.match,d="green"===t,h="team1"===u.greenTeam?"team2":"team1",s.matchInit&&(l.winner?(o({type:k}),r.push("/match")):u.winner?c().then(function(e){o(te({data:e.data.nextGame,history:r}))}):a({variables:{team:d?u.greenTeam:h,score:u["".concat(d?u.greenTeam:h,"_score")],increment:n<=450,matchId:s.matchId,gameId:s.gameId}}));case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()};function ae(){var e=Object(U.a)(["\n      query getActiveMatch {\n        activeMatch {\n          matchId\n          gameId\n          match {\n            winner\n            pointsToWin\n          }\n        }\n      }\n    "]);return ae=function(){return e},e}function ce(){var e=Object(L.b)(),t=Object(a.useState)({}),n=Object(J.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(!0),m=Object(J.a)(o,2),i=m[0],u=m[1];return Object(a.useEffect)(function(){var t=y.doc("app/activeIds").onSnapshot(function(t){r(t.data()),e({type:N,payload:t.data()}),i&&u(!1)});return function(){t()}},[]),Object(_.a)({},c,{loading:i})}function re(){var e=Object(L.b)(),t=ce(),n=t.matchId,c=t.gameId,r=t.loading,o=Object(a.useState)({team1_score:0,team2_score:0}),m=Object(J.a)(o,2),i=m[0],u=m[1];return Object(a.useEffect)(function(){if(!r){var t=y.doc("matches/".concat(n,"/games/").concat(c)).onSnapshot(function(t){u(t.data()),e({type:S,payload:t.data()})}),a=y.doc("matches/".concat(n)).onSnapshot(function(t){e({type:W,payload:t.data()})});return function(){t(),a()}}},[n,c,r]),function(e){var t=e.team1_score,n=e.team2_score,c=Object(L.b)(),r=Object(h.f)(),o=Object(a.useState)(null),m=Object(J.a)(o,2),i=m[0],u=m[1],s=Object(R.b)(Object(f.b)(ae()),{fetchPolicy:"network-only"}),l=s.data,d=s.loading;Object(a.useEffect)(function(){var e={team1:t,team2:n};if(!d){var a=l.activeMatch.match,c=a.pointsToWin;if(a.winner,Object.entries(e).find(function(e){var t=Object(J.a)(e,2);return t[0],t[1]>=c})&&Math.abs(t-n)>1){var r=Object.entries(e).sort(function(e,t){return e[1]<t[1]?1:-1})[0],o={finalScore:{team1_score:t,team2_score:n},winningTeam:r[0]};u(o)}}},[l,d,t,n]);var b=Object(R.a)(H),p=Object(J.a)(b,2),g=p[0],v=p[1];v.data,v.error,Object(a.useEffect)(function(){i&&!d&&g({variables:{matchId:l.activeMatch.matchId,gameId:l.activeMatch.gameId,winner:i.winningTeam}}).then(function(e){var t=e.data.declareWinner;c({type:M}),r.push("/match/winner",{match:Object(_.a)({},t)})})},[l,g,c,d,i])}({team1_score:i.team1_score,team2_score:i.team2_score}),{loading:r}}var oe=function(e){var t=e.side,n=Object(a.useContext)(h.d),r=(n.history,n.match.params),o=r.matchId,m=r.gameId,i=Object(R.a)(X,{variables:{matchId:o,gameId:m}}),u=Object(J.a)(i,2),s=u[0],l=u[1].loading,d=Object(a.useState)(!1),b=Object(J.a)(d,2),f=b[0],p=b[1],g=Object(a.useState)(!1),v=Object(J.a)(g,2),O=v[0],j=v[1],I=Object(L.c)(function(e){return e.game.greenTeam}),E="green"===t?I:"team1"===I?"team2":"team1",y=Object(L.c)(function(e){return{name:e.match["".concat(E,"_name")],score:e.game["".concat(E,"_score")]}}),_=y.name,T=y.score;return Object(a.useEffect)(function(){console.log(O,E,y.score),0!==y.score&&void 0!==y.score&&(j(!0),setTimeout(function(){j(!1)},1e3))},[y.score]),c.a.createElement("button",{className:"btn--increment "+t+"".concat(O?" scored":""),disabled:l&&f,onClick:function(){p(!0),s({variables:{team:E,score:T,increment:!0}}).then(function(e){p(!1)})}},c.a.createElement("p",{className:"team-name"},_&&_.length>0?_:E),c.a.createElement("p",{className:"score"},T))},me=(n(228),n(463)),ie=n(247);function ue(){var e=Object(U.a)(["\n      mutation NextGame($matchId: String!, $prevGreenTeam: TeamEnum!) {\n        nextGame(matchId: $matchId, prevGreenTeam: $prevGreenTeam) {\n          matchId\n          gameId\n          game {\n            team1_score\n            team2_score\n            servingTeam\n          }\n        }\n      }\n    "]);return ue=function(){return e},e}function se(e){var t=e.id,n=e.color,a=e.gamepad,c=e.dispatch,r=Object(me.a)(e,["id","color","gamepad","dispatch"]),o={};a.before(t,function(){o=new Date}).after(t,function(){var e=(new Date).getTime()-o.getTime();c(ne(Object(_.a)({buttonColor:n,dif:e},r)))})}function le(){var e=Object(U.a)(["\n  display: grid;\n  position: relative;\n  grid-template-columns: 1fr 50px 1fr;\n"]);return le=function(){return e},e}var de=B.a.div(le());function he(){!function(){var e=Object(L.b)(),t=Object(h.f)(),n=Object(L.c)(function(e){return{matchId:e.app.matchId,gameId:e.app.gameId,greenTeam:e.game.greenTeam}}),c=n.matchId,r=n.gameId,o=n.greenTeam,m=Object(R.a)(X),i=Object(J.a)(m,2),u=i[0],s=(i[1].loading,Object(R.a)(Object(f.b)(ue()),{variables:{matchId:c,prevGreenTeam:o}})),l=Object(J.a)(s,2),d=l[0];l[1].loading,Object(a.useEffect)(function(){return console.log("effect running"),ie.a.on("connect",function(n){var a={gamepad:n,dispatch:e,updateScore:u,nextGame:d,history:t};se(Object(_.a)({id:"button0",color:"green"},a)),se(Object(_.a)({id:"button3",color:"blue"},a))}),function(){ie.a.off("connect")}},[c,r])}();var e=re().loading,t=Object(h.f)(),n=Object(L.b)(),r=Object(L.c)(function(e){return Object(_.a)({},e.match,{},e.app,{game:e.game})});r.team1_name,r.team2_name,r.serveNum,r.pointsToWin,r.game,r.matchId,r.gameId;return e?null:c.a.createElement(de,{className:"pi-focused"},c.a.createElement(oe,{side:"green"}),c.a.createElement("div",{className:"center-btns",onClick:function(){n({type:k}),t.push("/match")}}),c.a.createElement(oe,{side:"blue"}))}var be=n(456),fe=n.n(be);function pe(){var e=Object(U.a)(["\n      mutation NextGame($matchId: String!, $prevGreenTeam: TeamEnum!) {\n        nextGame(matchId: $matchId, prevGreenTeam: $prevGreenTeam) {\n          matchId\n          gameId\n          game {\n            team1_score\n            team2_score\n            servingTeam\n          }\n        }\n      }\n    "]);return pe=function(){return e},e}function ge(){var e=Object(h.f)(),t=Object(L.b)(),n=Object(L.c)(function(e){return e.game.greenTeam}),r=Object(L.c)(function(e){return{team1:{name:e.match.team1_name,score:e.game.team1_score},team2:{name:e.match.team2_name,score:e.game.team2_score},greenTeam:e.game.greenTeam,isMatchOver:null!==e.match.winner,matchWinner:e.match.winner,gameWinner:e.game.winner,app:e.app}}),o=r.app,m=o.matchId,i=(o.gameId,r.isMatchOver),u=r.gameWinner,s=r.matchWinner,l=Object(R.a)(Object(f.b)(pe()),{variables:{matchId:m,prevGreenTeam:n}}),d=Object(J.a)(l,2),b=d[0],p=d[1].loading,g=i?s===n?"green":u===n?"green":"blue":"blue";return Object(a.useEffect)(function(){function n(n){n.key,b().then(function(n){t(te({data:n.data.nextGame,history:e}))})}return document.addEventListener("keydown",n),function(){document.removeEventListener("keydown",n)}},[t,e,b]),i&&setTimeout(function(){t({type:k}),e.push("/match")},1e4),u?c.a.createElement("div",{className:fe()("winner-screen pi-focused",g)},c.a.createElement("p",null,i?"".concat(r[s].name," wins the Match!"):"".concat(r[u].name," wins the Game!")),c.a.createElement("button",{className:"btn--full-width",onClick:function(){i?(t({type:k}),e.push("/match")):b().then(function(n){t(te({data:n.data.nextGame,history:e}))})}},i?"New Match":p?"Loading...":"Next Game")):c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,"Unknown Error"),c.a.createElement("button",{onClick:function(){return e.push("/match")}},"New Match Screen"))}var ve=function(e){e.history,e.match.params;var t=Object(L.c)(function(e){return e.app.matchInit}),n=Object(L.b)(),r=Object(R.b)(Z,{fetchPolicy:"network-only"}),o=r.data,m=r.loading;return Object(a.useEffect)(function(){var e;m||t||n({type:W,payload:null===(e=o.activeMatch)||void 0===e?void 0:e.match})},[o]),c.a.createElement(he,null)},Oe=n(89),je=n(457),Ie=n.n(je);n(959);function Ee(){var e=Object(U.a)(["\n    mutation CreateMatch(\n      $pointsToWin: Int\n      $gamesToWin: Int\n      $team1_name: String\n      $team2_name: String\n    ) {\n      createMatch(\n        pointsToWin: $pointsToWin\n        gamesToWin: $gamesToWin\n        team1_name: $team1_name\n        team2_name: $team2_name\n      ) {\n        matchId\n        gameId\n        match {\n          pointsToWin\n          gamesToWin\n          team1_name\n          team2_name\n        }\n        game {\n          team1_score\n          team2_score\n          servingTeam\n        }\n      }\n    }\n  "]);return Ee=function(){return e},e}var ye=function(e){var t=e.history,n=Object(L.b)(),r=Object(a.useState)(!1),o=Object(J.a)(r,2),m=o[0],i=o[1],u=Object(a.useState)(!1),s=Object(J.a)(u,2),l=s[0],d=s[1],h=Object(a.useState)(null),b=Object(J.a)(h,2),p=b[0],g=b[1],v=Object(a.useState)("default"),O=Object(J.a)(v,2),j=O[0],I=O[1],E=Object(a.useState)({team1_name:"",team2_name:"",pointsToWin:21,gamesToWin:2}),y=Object(J.a)(E,2),T=y[0],w=y[1],W=Object(R.a)(Object(f.b)(Ee())),S=Object(J.a)(W,2),k=S[0],$=S[1].loading,M=T.team1_name,N=T.team2_name,G=T.gamesToWin,C=T.pointsToWin;function x(e){w(Object(_.a)({},T,Object(Oe.a)({},e.target.name,"pointsToWin"===e.target.name||"gamesToWin"===e.target.name?parseInt(e.target.value):e.target.value)))}function A(e){d(!0),I("pointsToWin"===e.target.name?"numpad":"default"),w(Object(_.a)({},T,Object(Oe.a)({},e.target.name,""))),g(e.target.name),i(!0)}return c.a.createElement("div",{style:{display:"grid"},className:"pi-focused"},c.a.createElement("form",{className:"new-match-form",autoComplete:"off",onSubmit:function(){var e=Object(Q.a)(Y.a.mark(function e(a){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.preventDefault(),k({variables:T}).then(function(e){var a=e.data.createMatch;n(ee({data:a,history:t}))}).catch(function(e){return console.error(e)});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"team1",onFocus:function(e){return A(e)}},"Green:",c.a.createElement("input",{value:M,name:"team1_name",id:"team1",onChange:function(e){return x(e)}}))),c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"team2",onFocus:function(e){return A(e)}},"Blue:",c.a.createElement("input",{value:N,name:"team2_name",onChange:function(e){return x(e)},id:"team2"}))),c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"game-type"},"Best of:",c.a.createElement("select",{name:"gamesToWin",id:"game-type",value:G,onChange:function(e){return x(e)}},c.a.createElement("option",{value:"2"},"2/3"),c.a.createElement("option",{value:"1"},"1")))),c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"pointsToWin",onFocus:function(e){return A(e)},onBlur:function(){}},"Points To Win:",c.a.createElement("input",{type:"number",name:"pointsToWin",value:C,onChange:function(e){return x(e)}}))),c.a.createElement("button",{disabled:l,type:"submit",className:"btn--full-width"},$?"Loading...":"Start Match")),m&&c.a.createElement("div",{className:"keyboard__container ".concat("shift"===j?"keyboard__container--shift":"")},c.a.createElement("div",{className:"keyboard__input"},c.a.createElement("span",null,T[p])),c.a.createElement(Ie.a,{onChange:function(e){w(Object(_.a)({},T,Object(Oe.a)({},p,"pointsToWin"===p||"gamesToWin"===p?parseInt(e):e)))},inputName:p,layoutName:j,layout:{default:["q w e r t y u i o p {bksp}","a s d f g h j k l","z x c v b n m","{shift} & {space} , {close}"],shift:["Q W E R T Y U I O P {bksp}","A S D F G H J K L","Z X C V B N M","{shift} & {space} , {close}"],numpad:["7 8 9","4 5 6","1 2 3"," 0 {ok}"]},buttonTheme:[{class:"highlight",buttons:"{shift}"}],onKeyPress:function(e){"{shift}"===e&&I("default"===j?"shift":"default"),"{close}"!==e&&"{ok}"!==e||(i(!1),setTimeout(function(){d(!1)},100))},mergeDisplay:!0,display:{"{bksp}":"\u232b","{close}":"\u2713","{shift}":"\u21ea","{ok}":"\u2713"}})))};function _e(){var e=Object(U.a)(["\n      query getActiveMatch {\n        activeMatch {\n          match {\n            team1_name\n            team2_name\n          }\n        }\n      }\n    "]);return _e=function(){return e},e}function Te(){var e,t,n=ce(),r=n.matchId,o=(n.gameId,Object(R.b)(Object(f.b)(_e()),{fetchPolicy:"network-only"})),m=o.data,i=o.loading,u=o.refetch,s=re(),l=s.loading,d=s.data,h=d.greenTeam;return Object(a.useEffect)(function(){u()},[r]),l||i?c.a.createElement("p",null,"Loading..."):c.a.createElement("div",{className:"scoreboard"},c.a.createElement(we,{score:d["".concat(h,"_score")],team:null===(e=m.activeMatch)||void 0===e?void 0:e.match["".concat(h,"_name")]}),c.a.createElement(we,{score:d["".concat("team1"===h?"team2":"team1","_score")],team:null===(t=m.activeMatch)||void 0===t?void 0:t.match["".concat("team1"===h?"team2":"team1","_name")]}))}function we(e){var t=e.score,n=e.team;return c.a.createElement("div",{className:"team-score"},c.a.createElement("h1",null,n,":"),c.a.createElement("div",{className:"scoreboard__score"},t))}n(960);var We=n(458);n.n(We).a.init("mgellb/ping-pong");var Se,ke=(Se=I.a,Object(p.e)(A,F,P(p.a.apply(void 0,D),Object(v.reduxFirestore)(Se)))),$e=new f.a,Me=function(e){function t(){return Object(m.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return c.a.createElement(b.a,{client:$e},c.a.createElement(L.a,{store:ke},c.a.createElement(d.a,null,c.a.createElement(h.c,null,c.a.createElement(h.a,{path:["/match","/"],exact:!0,component:ye}),c.a.createElement(h.a,{path:["/match/:matchId/game/:gameId"],component:ve}),c.a.createElement(h.a,{path:"/scoreboard",component:Te}),c.a.createElement(h.a,{path:"/match/winner",component:ge})))))}}]),t}(c.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(Me,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[464,1,2]]]);
//# sourceMappingURL=main.cc90329a.chunk.js.map