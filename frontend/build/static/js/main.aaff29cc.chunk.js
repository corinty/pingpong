(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{249:function(e,t,a){e.exports=a(444)},254:function(e,t,a){},443:function(e,t,a){},444:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(103),o=a.n(r),m=(a(254),a(232)),i=a(233),s=a(245),u=a(234),l=a(246),d=a(73),h=a(39),b=a(15),p=a(21),f=a(38),v=a(235),g=a(150),O=a(236),j=a(74),E=a.n(j),y=(a(435),{apiKey:"AIzaSyCcrzECR6WLk_YtsCk6rUMbNxfFh0cn__8",authDomain:"tydev-ping-pong.firebaseapp.com",databaseURL:"https://tydev-ping-pong.firebaseio.com",projectId:"tydev-ping-pong",storageBucket:"tydev-ping-pong.appspot.com",messagingSenderId:"29869586839",appId:"1:29869586839:web:080ae459d72aa8f6"});E.a.initializeApp(y);var I=E.a.firestore(),_=a(5),w="INITIALIZE_GAME",T="INITIALIZE_MATCH",N="UPDATE_MATCH",k="UPDATE_GAME",S="EXIT_GAME",W="APP_ERROR",$="INCREMENT",M="DECREMENT",C={totalGamesPlayed:0,winner:null};var x=a(25),A={};var F={error:!1,errorMessage:"",matchInit:!1};var L=Object(f.c)({match:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return delete t.payload.match.__typename,t.payload.match;case N:return Object(_.a)({},e,t.payload);case S:return{};default:return e}},game:function(){var e,t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case T:return delete n.payload.game.__typename,Object(_.a)({},n.payload.game);case w:return Object(_.a)({},n.payload.game);case k:return n.payload||a;case S:return{};case $:var c=5===a.serveNum;return Object(_.a)({},a,(e={},Object(x.a)(e,n.team,a[n.team]+1),Object(x.a)(e,"whoServes",c?"team1"===a.whoServes?"team2":"team1":a.whoServes),e));case M:return 0===a[n.team]?a:Object(_.a)({},a,(t={},Object(x.a)(t,n.team,a[n.team]-1),Object(x.a)(t,"serveNum",1===a.serveNum?5:a.serveNum-1),Object(x.a)(t,"whoServes",1!==a.serveNum?a.whoServes:"team1"===a.whoServes?"team2":"team1"),t));default:return a}},app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.error,c=t.payload;switch(a){case T:return Object(_.a)({},e,{matchId:c.matchId,gameId:c.gameId,matchInit:!0});case W:return Object(_.a)({},e,{error:!0,errorMessage:n});case S:return Object(_.a)({},F,{matchInit:!1});default:return e}}}),D={},G=[v.a.withExtraArgument({getFirebase:O.getFirebase,getFirestore:g.getFirestore})],R=a(12),P=a(7),U=a(29),B=a(24);function X(e,t){var a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{dispatch:!0}).dispatch,c=Object(R.b)(),r=Object(n.useState)({team1_score:0,team2_score:0}),o=Object(P.a)(r,2),m=o[0],i=o[1],s=Object(n.useState)(!0),u=Object(P.a)(s,2),l=u[0],d=u[1];return Object(n.useEffect)(function(){if(e&&t){var n=I.doc("matches/".concat(e,"/games/").concat(t)).onSnapshot(function(e){i(e.data()),a&&c({type:k,payload:e.data()}),l&&d(!1)});return function(){n()}}},[c,t,l,e,a]),{data:m,loading:l}}function z(){var e=Object(U.a)(["\n    mutation DeclareWinner(\n      $matchId: String!\n      $gameId: String!\n      $winner: TeamEnum!\n    ) {\n      declareWinner(matchId: $matchId, gameId: $gameId, winner: $winner) {\n        winner\n        gamesWon {\n          team1\n          team2\n        }\n      }\n    }\n  "]);return z=function(){return e},e}function q(){var e=Object(U.a)(["\n      query getActiveMatch {\n        activeMatch {\n          matchId\n          gameId\n          match {\n            winner\n            pointsToWin\n          }\n        }\n      }\n    "]);return q=function(){return e},e}function H(){var e=Object(U.a)(["\n      mutation UpdateScore(\n        $matchId: String!\n        $gameId: String!\n        $team: TeamEnum!\n        $score: Int!\n        $increment: Boolean!\n      ) {\n        updateScore(\n          matchId: $matchId\n          gameId: $gameId\n          team: $team\n          increment: $increment\n          score: $score\n        ) {\n          team1_score\n          team2_score\n        }\n      }\n    "]);return H=function(){return e},e}function J(){var e=Object(U.a)(["\n  display: grid;\n  height: 100%;\n  position: relative;\n  grid-template-columns: 1fr 50px 1fr;\n"]);return J=function(){return e},e}var K=a(240).a.div(J());function V(){var e=Object(n.useContext)(h.e),t=e.history,a=e.match.params,r=a.matchId,o=a.gameId,m=Object(R.b)(),i=Object(R.c)(function(e){return Object(_.a)({},e.match,e.app,{game:e.game})}),s=i.team1_name,u=i.team2_name,l=(i.serveNum,i.pointsToWin,X(r,o)),d=l.data,b=d.team1_score,f=d.team2_score,v=l.loading,g=(function(e){var t=e.team1_score,a=e.team2_score,c=Object(R.b)(),r=Object(n.useState)(null),o=Object(P.a)(r,2),m=o[0],i=o[1],s=Object(B.b)(Object(p.b)(q()),{fetchPolicy:"network-only"}),u=s.data,l=s.loading;Object(n.useEffect)(function(){var e={team1:t,team2:a};if(!l){var n=u.activeMatch.match,c=n.pointsToWin;if(n.winner,Object.entries(e).find(function(e){var t=Object(P.a)(e,2);return t[0],t[1]>=c})&&Math.abs(t-a)>1){var r=Object.entries(e).sort(function(e,t){return e[1]<t[1]?1:-1})[0],o={finalScore:{team1_score:t,team2_score:a},winningTeam:r[0]};console.log(o),i(o)}}},[u.activeMatch,l,t,a]);var d=Object(B.a)(Object(p.b)(z())),h=Object(P.a)(d,2),b=h[0],f=h[1];f.data,f.error,Object(n.useEffect)(function(){m&&!l&&b({variables:{matchId:u.activeMatch.matchId,gameId:u.activeMatch.gameId,winner:m.winningTeam}}).then(function(e){c({type:N,payload:e.data.declareWinner})})},[u,b,c,l,m])}({team1_score:b,team2_score:f}),Object(B.a)(Object(p.b)(H()),{variables:{matchId:r,gameId:o}})),O=Object(P.a)(g,1)[0];return Object(n.useEffect)(function(){function e(e){switch(e.key){case"q":O({variables:{team:"team1",score:b,increment:!0}});break;case"a":O({variables:{team:"team1",score:b,increment:!1}});break;case"w":O({variables:{team:"team2",score:f,increment:!0}});break;case"s":O({variables:{team:"team2",score:f,increment:!1}})}}return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}},[m,b,f,O]),v?null:c.a.createElement(K,{className:"pi-focused"},c.a.createElement("div",{className:"btn--increment",onClick:function(e){O({variables:{team:"team1",score:b,increment:!0}})}},c.a.createElement("p",{className:"team-name"},s&&s.length>0?s:"Team 1"),c.a.createElement("p",{className:"score"},b)),c.a.createElement("div",{className:"center-btns",onClick:function(){m({type:S}),t.push("/match")}}),c.a.createElement("div",{className:"btn--increment",onClick:function(){O({variables:{team:"team2",score:f,increment:!0}})}},c.a.createElement("p",{className:"team-name"},u&&u.length>0?u:"Team 2"),c.a.createElement("p",{className:"score"},f)))}var Z=a(40),Y=a.n(Z),Q=a(77),ee=function(e){var t=e.data,a=e.history;return function(){var e=Object(Q.a)(Y.a.mark(function e(n){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n({type:T,payload:t}),a.push("/match/".concat(t.matchId,"/game/").concat(t.gameId),Object(_.a)({},t));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},te=function(e){var t=e.data,a=e.history;return function(){var e=Object(Q.a)(Y.a.mark(function e(n){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n({type:w,payload:t.game}),a.push("/match/".concat(t.matchId,"/game/").concat(t.gameId),Object(_.a)({},t));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()};function ae(){var e=Object(U.a)(["\n      mutation NextGame($matchId: String!) {\n        nextGame(matchId: $matchId) {\n          matchId\n          gameId\n          game {\n            team1_score\n            team2_score\n            servingTeam\n          }\n        }\n      }\n    "]);return ae=function(){return e},e}function ne(e){var t=e.winner,a=e.matchId,r=Object(n.useContext)(h.e).history,o=Object(R.b)(),m=Object(B.a)(Object(p.b)(ae()),{variables:{matchId:a}}),i=Object(P.a)(m,2),s=i[0],u=i[1].loading;return Object(n.useEffect)(function(){function e(e){e.key,s().then(function(e){o(te({data:e.data.nextGame,history:r}))})}return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}},[o,r,s]),t.match&&setTimeout(function(){o({type:S}),r.push("/match")},5e3),t.match?c.a.createElement("div",{className:"winner-screen"},c.a.createElement("p",null,"Match Winner ",t.match),c.a.createElement("button",{className:"btn--full-width",onClick:function(){o({type:S}),r.push("/match")}},"New Match")):c.a.createElement("div",{className:"winner-screen pi-focused"},c.a.createElement("p",null,"Game winner ",t.game),c.a.createElement("button",{className:"btn--full-width",onClick:function(){s().then(function(e){o(te({data:e.data.nextGame,history:r}))})}},u?"Loading...":"Next Game"))}var ce=function(e){e.history;var t=e.match.params,a=Object(R.c)(function(e){return{game:e.game.winner,match:e.match.winner}});return a.game||a.match?c.a.createElement(ne,{winner:a,matchId:t.matchId}):c.a.createElement(V,null)},re=a(244),oe=a.n(re);a(442);function me(){var e=Object(U.a)(["\n    mutation CreateMatch(\n      $pointsToWin: Int\n      $gamesToWin: Int\n      $team1_name: String\n      $team2_name: String\n    ) {\n      createMatch(\n        pointsToWin: $pointsToWin\n        gamesToWin: $gamesToWin\n        team1_name: $team1_name\n        team2_name: $team2_name\n      ) {\n        matchId\n        gameId\n        match {\n          pointsToWin\n          gamesToWin\n          team1_name\n          team2_name\n        }\n        game {\n          team1_score\n          team2_score\n          servingTeam\n        }\n      }\n    }\n  "]);return me=function(){return e},e}var ie=function(e){var t=e.history,a=Object(R.b)(),r=Object(n.useState)(!1),o=Object(P.a)(r,2),m=o[0],i=o[1],s=Object(n.useState)(null),u=Object(P.a)(s,2),l=u[0],d=u[1],h=Object(n.useState)("default"),b=Object(P.a)(h,2),f=b[0],v=b[1],g=Object(n.useState)({team1_name:"",team2_name:"",pointsToWin:21,gamesToWin:2}),O=Object(P.a)(g,2),j=O[0],E=O[1],y=Object(B.a)(Object(p.b)(me())),I=Object(P.a)(y,2),w=I[0],T=I[1].loading,N=j.team1_name,k=j.team2_name,S=j.gamesToWin,W=j.pointsToWin;function $(e){E(Object(_.a)({},j,Object(x.a)({},e.target.name,"pointsToWin"===e.target.name||"gamesToWin"===e.target.name?parseInt(e.target.value):e.target.value)))}function M(e){v("pointsToWin"===e.target.name?"numpad":"default"),E(Object(_.a)({},j,Object(x.a)({},e.target.name,""))),d(e.target.name),i(!0)}return c.a.createElement("div",{style:{display:"grid"},className:"pi-focused"},c.a.createElement("form",{className:"new-match-form",autoComplete:"off",onSubmit:function(){var e=Object(Q.a)(Y.a.mark(function e(n){return Y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),w({variables:j}).then(function(e){var n=e.data.createMatch;a(ee({data:n,history:t}))}).catch(function(e){return console.error(e)});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"team1",onFocus:function(e){return M(e)}},"Team 1:",c.a.createElement("input",{value:N,name:"team1_name",id:"team1",onChange:function(e){return $(e)}}))),c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"team2",onFocus:function(e){return M(e)}},"Team 2:",c.a.createElement("input",{value:k,name:"team2_name",onChange:function(e){return $(e)},id:"team2"}))),c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"game-type"},"Best of:",c.a.createElement("select",{name:"gamesToWin",id:"game-type",value:S,onChange:function(e){return $(e)}},c.a.createElement("option",{value:"2"},"2/3"),c.a.createElement("option",{value:"1"},"1")))),c.a.createElement("div",null,c.a.createElement("label",{htmlFor:"pointsToWin",onFocus:function(e){return M(e)},onBlur:function(){}},"Points To Win:",c.a.createElement("input",{type:"number",name:"pointsToWin",value:W,onChange:function(e){return $(e)}}))),c.a.createElement("button",{disabled:m,type:"submit",className:"btn--full-width"},T?"Loading...":"Start Match")),m&&c.a.createElement("div",{className:"keyboard__container ".concat("shift"===f?"keyboard__container--shift":"")},c.a.createElement("div",{className:"keyboard__input"},c.a.createElement("span",null,j[l])),c.a.createElement(oe.a,{onChange:function(e){E(Object(_.a)({},j,Object(x.a)({},l,"pointsToWin"===l||"gamesToWin"===l?parseInt(e):e)))},inputName:l,layoutName:f,layout:{default:["q w e r t y u i o p {bksp}","a s d f g h j k l","z x c v b n m","{shift} & {space} , {close}"],shift:["Q W E R T Y U I O P {bksp}","A S D F G H J K L","Z X C V B N M","{shift} & {space} , {close}"],numpad:["7 8 9","4 5 6","1 2 3"," 0 {ok}"]},buttonTheme:[{class:"highlight",buttons:"{shift}"}],onKeyPress:function(e){"{shift}"===e&&v("default"===f?"shift":"default"),"{close}"!==e&&"{ok}"!==e||i(!1)},mergeDisplay:!0,display:{"{bksp}":"\u232b","{close}":"\u2713","{shift}":"\u21ea","{ok}":"\u2713"}})))};function se(){var e=function(){Object(R.b)();var e=Object(n.useState)({}),t=Object(P.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!0),o=Object(P.a)(r,2),m=o[0],i=o[1];return Object(n.useEffect)(function(){var e=I.doc("app/activeIds").onSnapshot(function(e){console.log("updating game ids"),c(e.data()),m&&i(!1)});return function(){e()}}),Object(_.a)({},a,{loading:m})}(),t=X(e.matchId,e.gameId,{dispatch:!1}),a=t.loading,r=t.data;return a?c.a.createElement("p",null,"Loading..."):c.a.createElement("div",{className:"scoreboard"},c.a.createElement("h1",null,"Team 1: "),c.a.createElement("h1",null,"Team 2: "),c.a.createElement("div",{className:"scoreboard__score"},null===r||void 0===r?void 0:r.team1_score),c.a.createElement("div",{className:"scoreboard__score"},null===r||void 0===r?void 0:r.team2_score))}a(443);var ue,le=(ue=E.a,Object(f.e)(L,D,Object(f.d)(f.a.apply(void 0,G),Object(g.reduxFirestore)(ue),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()))),de=new p.a,he=function(e){function t(){return Object(m.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return c.a.createElement(b.a,{client:de},c.a.createElement(R.a,{store:le},c.a.createElement(d.a,null,c.a.createElement(h.d,null,c.a.createElement(h.b,{path:["/match","/"],exact:!0,component:ie}),c.a.createElement(h.a,{from:"/",to:"/match"}),c.a.createElement(h.b,{path:["/match/:matchId/game/:gameId"],component:ce}),c.a.createElement(h.b,{path:"/scoreboard",component:se})))))}}]),t}(c.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(he,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[249,1,2]]]);
//# sourceMappingURL=main.aaff29cc.chunk.js.map